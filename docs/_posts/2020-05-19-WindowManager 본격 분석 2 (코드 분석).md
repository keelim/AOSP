---
layout: post
title: "WindowManager 코드 본격 분석"
date: 2020-05-19 00:00:01
author: Keelim
categories: AOSP
comments: true
toc: true
toc_sticky: true
---

## 개념 보충

프로젝트를 진행을 하면서 개념 보충 해야 하는 것들을 진행을 해보기로 하였다.

`WindowMangaer` --> Surface Flinger 위에 위치하며, 기기화면에 그릴 내용을 Surface Flinger 로 전달

`Core Platform Service` 어플리케이션과는 직접 상호작용은 하지 않지만 안드로이드 프레임워크가 종작하는데 필수적인 서비스

`Activity Manger`, `Package Manger` 우연찮게 겹친다.

![그림](https://github.com/keelim/AOSP/blob/master/docs/assets/as1.png?raw=true)

### 안드로이드 플랫폼 이해 용어 정리 --> 용어 정리를 다시 해보았습니다

`시스템 서버`: 시스템 서비스를 실행하는 프로세스

`서비스 클라이언트`: 시스템 서비프록스를 사용하는 프로세스

`컨텍스트 매니저`: 시스템 서비스를 관리하는 안드로이드 시스템프로세스로서 시스템에 설치 돼 있는 각종 시스템 서비스의 위치 정보인 핸들을 관리
핸들은 바인더 IPC 의 목적지 주소 지정 사용

`서비스 프레임워크`: 서비스 매니저를 포함 서비스 사용자와 시스템 서비스간의 RPC 동작에 필요한 공통적인 클래스 정의

`서비스 인터페이스`: 서비스 사용자와 시스템 서비스 간에 미리 정해진 인터페이스로서 시스템 서비스는 해당 인터페이스에 맞게 스텁 함수를 구현해서 해당 서비스를 제공해야
하고, 반대롤 서비스 사용자 역시 해당 인터페이스에 맞게 서비스를 호출해야 함

`서비스`: 서비스 인터페이스에 정의된 기능을 서비스 스텁 함수로 구현해서 실제 서비스의 기능을 제공하는 모듈을 의미

`서비스 프록시`: RPC 수행 시 데이터 마샬링을 수행하는 객체이며 서비스 인터페이스별로 존재한다. 서비스 인터페이스에정의된 함수별로 각각 데이터 마샬링을
수행하는 프록시 함수를 제공

`서비스 스텁` : RPC 수행 시 데이터 언마샬링을 수행하는 객체이며, 이 객체 역시 서비스 인터페이스별로 존재한다. 수신된 데이터를 언마샬링해서 연관된 서비스 스텁
힘수 호출

`바인더 드라이버` : 바인더는 안드로이드에서 IPC를 지원하는 데 사용되는 메커니즘으로 안드로이드 리눅스 커널의 디바이스 드라이버 형태로 포함돼 있다.

`바인더 IPC`: 서비스 프레임워크와 바인더 드라이버 사이에 사용되는 데이터 포멧

`바인더 RPC`:서비스 사용자가 서비스에서 제공하는 특정 서비스 인터페이스 기반의 함수를 마치 자신의 로컬 함수를 호출하듯이 원격으로 처리하는 동작을 말함. 바이던 RPC는 내부적으로 바인더 IPC 기반으로 동작

`바인더 RPC 데이터` :서비스 사용자와 서비스 간의 바이던 RPC를 수행하는 데 사용되는 데이터

`마샬링`: 직렬화와의 가장 큰 차이점은 직렬화는 객체가 대상이지만 마샬링은 변환자체에 목적이 있기 때문에,
대상과 변환할 오브젝트가 한정되지 않는다. 서로 다른 언어간의 데이터 전송은 직렬화라고 하지 않고 마샬링이라고 함.

![그림](https://github.com/keelim/AOSP/blob/master/docs/assets/as2.png?raw=true)
![그림](https://github.com/keelim/AOSP/blob/master/docs/assets/as3.png?raw=true)

### 참고

- [<https://developer.android.com/>]
- [<http://oss.kr/]>
- 인사이드 안드로이드
- [<https://cs.android.com/>]
